<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4CAF50">
    <title>Exportar - Yeah¡</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-btn">← Volver</a>
            <h1>Exportar Datos</h1>
        </header>

        <main class="export-container">
            <div class="export-section">
                <h2>Exportar a CSV</h2>
                <p>Descarga todos tus check-ins en formato CSV para usar en Excel u otras aplicaciones.</p>
                <button id="exportCSV" class="btn-primary">Descargar CSV</button>
            </div>

            <div class="export-section">
                <h2>Exportar a iCal</h2>
                <p>Descarga tus check-ins como eventos de calendario para importar en Google Calendar, Apple Calendar, etc.</p>
                <button id="exportICal" class="btn-primary">Descargar iCal</button>
            </div>

            <div class="export-section">
                <h2>Exportar JSON (Backup)</h2>
                <p>Crea una copia de seguridad completa de todos tus datos (incluye fotos).</p>
                <button id="exportJSON" class="btn-primary">Descargar JSON</button>
            </div>

            <div class="export-section">
                <h2>Importar Backup</h2>
                <p>Restaura tus datos desde un archivo JSON de backup.</p>
                <input type="file" id="importFile" accept=".json" style="display: none;">
                <button id="importJSON" class="btn-primary">Importar JSON</button>
                <p class="hint" style="color: #f44336; margin-top: 0.5rem;">Advertencia: Esto reemplazará todos tus datos actuales</p>
            </div>

            <div class="export-section danger-zone">
                <h2>Zona de Peligro</h2>
                <p>Elimina permanentemente todos tus check-ins. Esta acción no se puede deshacer.</p>
                <button id="clearAll" class="btn-danger">Eliminar Todos los Datos</button>
            </div>
        </main>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/export.js"></script>
    <script>
        document.getElementById('exportCSV').addEventListener('click', () => {
            Export.toCSV();
        });

        document.getElementById('exportICal').addEventListener('click', () => {
            Export.toICal();
        });

        document.getElementById('exportJSON').addEventListener('click', () => {
            Export.toJSON();
        });

        document.getElementById('importJSON').addEventListener('click', () => {
            document.getElementById('importFile').click();
        });

        document.getElementById('importFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    if (confirm('¿Estás seguro? Esto reemplazará todos tus datos actuales.')) {
                        if (Storage.importData(data)) {
                            alert('Datos importados correctamente');
                            window.location.href = 'index.html';
                        } else {
                            alert('Error al importar datos. Verifica el archivo.');
                        }
                    }
                } catch (error) {
                    alert('Archivo inválido');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        });

        document.getElementById('clearAll').addEventListener('click', () => {
            if (confirm('¿ESTÁS SEGURO? Esto eliminará TODOS tus check-ins permanentemente.')) {
                if (confirm('Última confirmación. ¿Realmente quieres eliminar todo?')) {
                    Storage.clearAll();
                    alert('Todos los datos han sido eliminados');
                    window.location.href = 'index.html';
                }
            }
        });
    </script>
</body>
</html>
